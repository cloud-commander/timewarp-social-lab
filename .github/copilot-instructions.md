<!-- .github/copilot-instructions.md for LoveLink 2000 -->
# Copilot / AI Agent Instructions — LoveLink 2000

Purpose: concise, project-specific guidance so an AI coding agent can be immediately productive working on this legacy PHP + Docker project.

Key points (read before editing code):
- **Architecture:** Two separate stacks are in the repo: `wap-*` and `web98-*` (see `docker-compose.yml`). Each stack runs an Apache+PHP container and a MySQL init container. Content is mounted from `content/` (WAP) and `content-web98/` (Web98).
- **Primary language & era:** Classic PHP (PHP 4 style), using `mysql_*` functions, `session_register`, and legacy superglobals like `$HTTP_POST_VARS`. Code assumes old MySQL behavior and MD5-hashed passwords.
- **DB & services:** Docker service names are significant — e.g. `wap-db`, `web98-db`. `content/db.php` connects to `wap-db` by hostname. Modifying service names requires updating constants or docker-compose mappings.

How to run locally (developer workflow):
- Start services: `docker-compose up --build` from repo root. Services to check: `wap-server`, `wap-db`, `web98-server`, `web98-db`.
- The DB init scripts are in `db-init/` and `db-init-web98/` and run inside containers via `command: ["sh", "/docker-entrypoint-initdb.d/init-db.sh"]` in `docker-compose.yml`.
- To regenerate mock users/images: run `scripts/generate_mock_data.py`. Use the repo's Python venv `venv-local` or activate your own environment and `pip install pillow` first. The script writes to `content/img` and `content/seed_users.sql`.

Project-specific conventions and patterns:
- Legacy globals: code relies on `session_register`, `$HTTP_SESSION_VARS`, `$HTTP_POST_VARS`, `$HTTP_GET_VARS`. Prefer minimally-invasive changes that preserve behavior unless you update call sites across files.
- DB access: plain `mysql_query()` calls with interpolated variables are common (see `content/index.php`, `content/action.php`, `content/login.php`). Inputs are sometimes escaped via `addslashes()` but overall SQL injection risk is present — when refactoring, add tests and/or use parameterized queries consistently.
- Passwords: MD5 hashes stored in DB (32-char). Tests and mock data (e.g., `schema.sql`, `generate_mock_data.py`) expect MD5 of `password` = `5f4dcc3b5aa765d61d8327deb882cf99`.
- Photos: primary photo is stored in `user_photos` with `is_primary = 1`. Placeholder images are generated by `img_gen.php` when no photo exists.
- Latency simulation: `content/init.php` intentionally calls `usleep()` to simulate GPRS latency. Tests that exercise UI timing should account for this.

Important files to review before making changes (examples):
- `content/index.php` — swipe deck and SQL used to select candidates.
- `content/action.php` — handles `pass` / `date` actions and match creation.
- `content/login.php`, `content/register.php` — auth flow using legacy sessions and MD5.
- `content/db.php` — database connection constants; change with care.
- `content/schema.sql` and `content/seed_users.sql` — canonical schema & seed data format.
- `scripts/generate_mock_data.py` — image processing and SQL generation example (Python + Pillow).

Editing guidance (practical rules for agents):
- Preserve runtime compatibility: do not change session semantics or remove legacy superglobal usage without applying coordinated changes across files.
- Avoid global search-and-replace of `mysql_*` to `mysqli` or PDO in a single PR; prefer small incremental changes with tests and an accompanying compatibility shim if needed.
- When changing DB schema, update `db-init/` or `db-init-web98/` init scripts and provide a migration / README note explaining how to re-seed containers.
- Keep Docker mappings in sync: `docker-compose.yml` mounts `./content` and `./content-web98` into containers — edits to local files immediately affect running containers.
- When adding Python dependencies for scripts, prefer documenting them in a small `requirements.txt` (don't assume the `venv-local` contains them for CI).

Safety & tests:
- The app is deliberately vulnerable in many places. When adding fixes or refactors, include a short compatibility test or a seed reload step so reviewers can validate behavior on the running containers.
- Example quick smoke steps to validate edits locally:
  - `docker-compose up --build -d`
  - Wait for DB initialization to complete (watch container logs)
  - Visit `http://localhost:8080/` for the WAP UI and `http://localhost:8081/` for Web98 UI
  - To re-seed from `content/seed_users.sql`, exec into the DB container and run `mysql lovelink < /docker-entrypoint-initdb.d/seed_users.sql` (container paths may vary depending on init layout).

When in doubt, ask the maintainer for the target compatibility level (modernize vs. preserve legacy behavior). If a proposed change touches `db.php`, session handling in `init.php`, or service names in `docker-compose.yml`, include a short migration plan and smoke-test steps in the PR description.

Where to look for related artifacts:
- Docker composition: `docker-compose.yml`
- Server content (WAP): `content/`
- Server content (Web98): `content-web98/`
- DB init & schema: `db-init/`, `db-init-web98/`, `content/schema.sql`
- Utilities: `scripts/` (image generation, seeding helpers)

If anything here is unclear or you need more examples (e.g., a sample PR that modernizes a single query), request a follow-up and include which file(s) you intend to modify.
